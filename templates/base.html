{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap.min.css' %}">
    <!-- pybo CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
    <title>Hello, pybo!</title>
    <style>
        .chat-room-container {
            display: flex;
            justify-content: flex-start;
        }
        .chat-room-container .chat-room {
            flex: 1;
            margin-left: 0px;
        }
    </style>
</head>
<body>
{% include "navbar.html" %}

<div class="container">
    <div class="row">
        <div class="col-4">
            <div class="chat-room-container">
                <div class="chat-room">
                    <h1>Chat Room</h1>
                    <textarea id="chat-log" cols="30" rows="20"></textarea><br>
                    <input id="chat-message-input" type="text" size="30"><br>
                    <input id="chat-message-submit" type="button" value="Send">
                    {{ room_name|json_script:"room-name" }}
                    <script>
                        const roomName = JSON.parse(document.getElementById('room-name').textContent);

                        const chatSocket = new WebSocket(
                            'ws://'
                            + window.location.host
                            + '/ws/chat/'
                            + roomName
                            + '/'
                        );

                        chatSocket.onmessage = function(e) {
                            const data = JSON.parse(e.data);
                            document.querySelector('#chat-log').value += (data.message + '\n');
                        };

                        chatSocket.onclose = function(e) {
                            console.error('Chat socket closed unexpectedly');
                        };

                        document.querySelector('#chat-message-input').focus();
                        document.querySelector('#chat-message-input').onkeyup = function(e) {
                            if (e.keyCode === 13) {  // enter, return
                                document.querySelector('#chat-message-submit').click();
                            }
                        };

                        document.querySelector('#chat-message-submit').onclick = function(e) {
                            const messageInputDom = document.querySelector('#chat-message-input');
                            const message = messageInputDom.value;
                            chatSocket.send(JSON.stringify({
                                'message': message
                            }));
                            messageInputDom.value = '';
                        };
                    </script>
                </div>
            </div>
        </div>
        <div class="col">
            <!-- 기본 템플릿 안에 삽입될 내용 Start -->
            {% block content %}
            {% endblock %}
            <!--Start of Tawk.to Script-->
            <script type="text/javascript">
                var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
                (function(){
                var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
                s1.async=true;
                s1.src='https://embed.tawk.to/64643e1aad80445890ed5e02/1h0jp568e';
                s1.charset='UTF-8';
                s1.setAttribute('crossorigin','*');
                s0.parentNode.insertBefore(s1,s0);
                })();
            </script>
            <!--End of Tawk.to Script-->
            <!-- jQuery JS -->
            <script src="{% static 'jquery-3.4.1.min.js' %}"></script>
            <!-- Bootstrap JS -->
            <script src="{% static 'bootstrap.min.js' %}"></script>
            <!-- 자바스크립트 Start -->
            {% block script %}
            {% endblock %}
            <!-- 자바스크립트 End -->
            </div>
            </div>
            
            </div>
            </body>
            </html>